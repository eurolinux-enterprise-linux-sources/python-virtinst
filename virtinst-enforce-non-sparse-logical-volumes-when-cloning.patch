From bf1fb99e0dc3c5f632dd4b4cbd28fd5493071572 Mon Sep 17 00:00:00 2001
From: Giuseppe Scrivano <gscrivan@redhat.com>
Date: Sat, 1 Feb 2014 00:30:18 +0100
Subject: [PATCH] enforce non sparse logical volumes when cloning

RHEL-only

Closes: https://bugzilla.redhat.com/show_bug.cgi?id=1055225

Signed-off-by: Giuseppe Scrivano <gscrivan@redhat.com>
---
 virtinst/CloneManager.py | 2 +-
 virtinst/Storage.py      | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/virtinst/CloneManager.py b/virtinst/CloneManager.py
index f7bbe87..8dbd3e4 100644
--- a/virtinst/CloneManager.py
+++ b/virtinst/CloneManager.py
@@ -223,7 +223,7 @@ class CloneDesign(object):
                 if not path:
                     device = VirtualDisk.DEVICE_CDROM
 
-                disk = VirtualDisk(path, size=.0000001,
+                disk = VirtualDisk(path, size=.0000001, sparse=False,
                                    conn=self._hyper_conn,
                                    device=device)
                 disklist.append(disk)
diff --git a/virtinst/Storage.py b/virtinst/Storage.py
index 56a19ad..9d9046c 100644
--- a/virtinst/Storage.py
+++ b/virtinst/Storage.py
@@ -1365,6 +1365,7 @@ class LogicalVolume(StorageVolume):
     capacity = property(StorageVolume.get_capacity, set_capacity)
 
     def set_allocation(self, allocation):
+        allocation = int(allocation)
         if allocation != self.capacity:
             raise ValueError(_("Sparse logical volumes are not supported, "
                                "allocation must be equal to capacity"))
-- 
1.8.5.3

